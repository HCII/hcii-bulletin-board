<!DOCTYPE html>
<!--
	Scroll Display for the HCII Bulletin Board
	Licensed under the MIT License (http://www.opensource.org/licenses/mit-license.php).
-->
<html>
<head>
	<title>Scroll - HCII Bulletin Board</title>
	
	<style type="text/css">
	html,body {
		margin:0;
		padding:0;
		background-color:#999;
	}
	#display {
		color:#000;
	}
		#display>.cell {
			float:left;
			margin:3px;
			padding:5px;
			background-color:#fff;
			text-align:center;
			-webkit-box-shadow:0 3px 5px rgba(0,0,0,0.5);
			-moz-box-shadow:0 3px 5px rgba(0,0,0,0.5);
			box-shadow:0 3px 5px rgba(0,0,0,0.5);
			z-index:0;
		}
		#display>.cell>.img-box {
			margin-bottom:3px;
			width:120px;
			height:120px;
			overflow:hidden;
		}
		#display>.cell>.img-box>img {
			width:120px;
		}
		#display>.cell>.name {
			font-family:Helvetica,Arial,sans-serif;
			font-size:11px;
		}

	.row { 
		width: 800px; 
		height: 130px; 
		overflow-x: hidden; 
		overflow-y: hidden; 
		display: inline-block; 
		position: relative; }
	.row-container {
		position: relative;
	}
	.row-items { 
		height: 130px;
		position: absolute;
	 }
	.profile { display: inline; }
	.infobox { position: fixed; width: 130px; height: 180px; z-index: 99; background: #ccc;  }
	#faculty-info { top: 9px; left: 200px; }
	#staff-info { top: 146px; left: 550px; }
	#phd-info { top: 279px; left: 150px; }
	#masters-info { top: 416px; left: 400px; }
	.info-pic { width: 130px; height: 130px; }
	</style>
</head>
<body>
	
<div id="display"></div>

<!-- Javascripts -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.ianli.com/javascripts/underscore/1.1.6/underscore.min.js"></script>
<script type="text/javascript" src="jquery.scrollTo.js"></script>
<script type="text/javascript">

picWidth = 130;
faculty = [];
staff = [];
masters = [];
phd = [];
whichFac = 0;
whichStaff = 0;
whichPhd = 0;
whichMasters = 0;
intervalLen = 100;
count = 0;

// The template for the cells that appear in the display.
var template = _.template(
	'<div class="cell">' +
		'<div class="img-box">' +
			'<img src="<%= image %>" />' +
		'</div>' +
		'<div class="name"><%= first_name %> <%= last_name %></div>' +
	'</div>'
);

// Fetch the JSON file of people.
$.getJSON('/people.json', function (data, textStatus, jqXHR) {
	_.each(data, function (value, i) {
		if (!value.person.image) {
			// Set image to a default blank image.
			value.person.image = 'blank.png';
		} 

		if (!value.person.room) { 
			value.person.room = "";
		}
	});

	_.each(data, function (value, i) {
		appendProfile(value.person, value.person.level);
		
		if (value.person.level == 'faculty') {
			faculty.push(value.person);
		} else if (value.person.level == 'staff') {
			staff.push(value.person);
		} else if (value.person.level == 'phd') {
			phd.push(value.person);
		} else if (value.person.level == 'masters') {
			masters.push(value.person);
		}
	});

	numFac = faculty.length;
	numStaff = staff.length;
	numPhd = phd.length;
	numMasters = masters.length;

	$("#faculty-row-0").css("width", picWidth*numFac);
	$("#faculty-row-1").css("width", picWidth*numFac);
	$("#staff-row-0").css("width", picWidth*numStaff);
	$("#staff-row-1").css("width", picWidth*numStaff);
	$("#phd-row-0").css("width", picWidth*numPhd);
	$("#phd-row-1").css("width", picWidth*numPhd);
	$("#masters-row-0").css("width", picWidth*numMasters);
	$("#masters-row-1").css("width", picWidth*numMasters);

	setInterval(imageScroll, intervalLen);

});

var appendProfile = function(person, level) {
	var profile_tag = $("<li>").addClass("profile")
	var profile_img_tag = $("<img>").attr("src", person.image)
	profile_img_tag.attr("height", 130)
		       .attr("width", 130)
		       .appendTo(profile_tag);
	$("#" + level + "-row-0").append(profile_tag);
	$("#" + level + "-row-1").append(profile_tag.clone());
};

var showInfo = function() {
	var person = faculty[whichFac];
	var featured_img_tag = $("<img>").addClass("info-pic").attr("src", person.image);
	$("#faculty-info").html(person.first_name + " " + person.last_name + "<br />" + person.room)
			  .prepend(featured_img_tag);

	person = staff[whichStaff];
	featured_img_tag = $("<img>").addClass("info-pic").attr("src", person.image);
	$("#staff-info").html(person.first_name + " " + person.last_name + "<br />" + person.room)
		        .prepend(featured_img_tag);

	person = phd[whichPhd];
	featured_img_tag = $("<img>").addClass("info-pic").attr("src", person.image);
	$("#phd-info").html(person.first_name + " " + person.last_name + "<br />" + person.room)
		        .prepend(featured_img_tag);

	person = masters[whichMasters];
	featured_img_tag = $("<img>").addClass("info-pic").attr("src", person.image);
	$("#masters-info").html(person.first_name + " " + person.last_name + "<br />" + person.room)
		       	.prepend(featured_img_tag);



}

var imageScroll = function() { 
	count = count + 1;

	whichFac = (whichFac + 1) % numFac;
	$("#faculty-box").scrollTo("+=" + picWidth + "px", intervalLen, { axis: "x",  onAfter: showInfo, easing: "linear" });


	// move strip of images to the right if it has reached the end
	if (whichFac == 0) {
		var width = $("#faculty-row-0").width();
		if ((count / numFac) % 2 == 1) {
			var left = parseInt($("#faculty-row-1").css("left"));
			$("#faculty-row-0").css("left", left + width);
		} else {
			var left = parseInt($("#faculty-row-0").css("left"));
			$("#faculty-row-1").css("left", left + width);
		}
	}			
			

	whichStaff = (whichStaff + 1) % numStaff;
	$("#staff-box").scrollTo("+=" + picWidth + "px", intervalLen, { axis: "x",  onAfter: showInfo, easing: "linear" });

	if (whichStaff == 0) {
		var width = $("#staff-row-0").width();
		if ((count / numFac) % 2 == 1) {
			var left = parseInt($("#staff-row-1").css("left"));
			$("#staff-row-0").css("left", left + width);
		} else {
			var left = parseInt($("#staff-row-0").css("left"));
			$("#staff-row-1").css("left", left + width);
		}
	}			

	whichPhd = (whichPhd + 1) % numPhd;
	$("#phd-box").scrollTo("+=" + picWidth + "px", intervalLen, { axis: "x",  onAfter: showInfo, easing: "linear" });

	if (whichPhd == 0) {
		$("#phd-box").scrollTo("0px");
		/*
		var width = $("#phd-row-0").width();
		if ((count / numFac) % 2 == 1) {
			var left = parseInt($("#phd-row-1").css("left"));
			$("#phd-row-0").css("left", left + width);
		} else {
			var left = parseInt($("#phd-row-0").css("left"));
			$("#phd-row-1").css("left", left + width);
		}*/
	}			

	whichMasters = (whichMasters + 1) % numMasters;
	$("#masters-box").scrollTo("+=" + picWidth + "px", intervalLen, { axis: "x",  onAfter: showInfo, easing: "linear" });

	if (whichMasters == 0) {
		
		/*
		var width = $("#masters-row-0").width();
		if ((count / numFac) % 2 == 1) {
			var left = parseInt($("#masters-row-1").css("left"));
			$("#masters-row-0").css("left", left + width);
		} else {
			var left = parseInt($("#masters-row-0").css("left"));
			$("#masters-row-1").css("left", left + width);
		}*/
	}			

};



</script>

<div id="faculty-info" class="infobox"></div>
<div id="staff-info" class="infobox"></div>
<div id="phd-info" class="infobox"></div>
<div id="masters-info" class="infobox"></div>

<div id="faculty-box" class="row">
<ul id="faculty-row-0" class="row-items"></ul>
<ul id="faculty-row-1" class="row-items"></ul>
</div>

<div id="staff-box" class="row">
<ul id="staff-row-0" class="row-items"></ul>
<ul id="staff-row-1" class="row-items"></ul>
</div>

<div id="phd-box" class="row">
<ul id="phd-row-0" class="row-items"></ul>
<ul id="phd-row-1" class="row-items"></ul>
</div>

<div id="masters-box" class="row">
<ul id="masters-row-0" class="row-items"></ul>
<ul id="masters-row-1" class="row-items"></ul>
</div>

</body>
</html>
