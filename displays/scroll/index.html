<!DOCTYPE html>
<!--
	Scroll Display for the HCII Bulletin Board
	
	Copyright (c) 2011 Ian Li (http://ianli.com/) and Ryan Muller
	Licensed under the MIT License (http://www.opensource.org/licenses/mit-license.php).
	
	The idea for the design was discussed by:
	* Rebecca Gulotta
	* Peter Kinnaird
	* Ian Li
	* Derek Lomas
	* Ryan Muller
	* Sarah Reeder
	* Kelly Rivers
-->
<html>
<head>
	<title>Scroll - HCII Bulletin Board</title>
	
	<style type="text/css">
	html,body {
		margin:0;
		padding:0;
		background-color:#999;
	}
	
	/* Header */
	.header {
		padding:5px 0 0 5px;
		font-family:Helvetica,Arial,sans-serif;
		font-weight:bold;
		font-size:16px;
		color:#fff;
		text-shadow:0 -1px 0 #000;
	}
	
	/* The viewport in which ScrollingWall creates tiles. */
	.viewport {
		position:relative;
		width:100%;
		height:160px;
		overflow:hidden;
	}
		.viewport ._strip {
			position:absolute;
		}
		.viewport ._tile {
			position:absolute;
			width:140px;
			height:198px;
		}
		
	/* The tile for each person */
	.person-tile {
		margin:3px;
		padding:5px;
		width:120px;
		background-color:#fff;
		-webkit-box-shadow:0 3px 5px rgba(0,0,0,0.5);
		-moz-box-shadow:0 3px 5px rgba(0,0,0,0.5);
		box-shadow:0 3px 5px rgba(0,0,0,0.5);
		text-align:center;
		cursor:pointer;
	}
		.person-tile>._box {
			margin-bottom:5px;
			width:120px;
			height:120px;
			background-color:#333;
			overflow:hidden;
		}
		.person-tile>._box>img {
			width:120px;
		}
		.person-tile>._name {
			font-family:Helvetica,Arial,sans-serif;
			font-size:12px;
		}
		
	/* The TinyModal display */
	#person-info-modal {
		display:none;
		width:200px;
		background-color:#fff;
		-webkit-box-shadow:0 3px 5px rgba(0,0,0,0.5);
		-moz-box-shadow:0 3px 5px rgba(0,0,0,0.5);
		box-shadow:0 3px 5px rgba(0,0,0,0.5);
		text-align:center;
	}
		.person-info {
			padding:10px;
		}
		.person-info>._box {
			margin-bottom:10px;
			width:180px;
			height:180px;
			background-color:#333;
			overflow:hidden;
		}
		.person-info>._box>img {
			width:180px;
		}
		.person-info>._name,
		.person-info>._title,
		.person-info>._room {
			font-family:Helvetica,Arial,sans-serif;
			font-size:15px;
		}
		.person-info>._name {
			font-weight:bold;
		}
	</style>
</head>
<body>

<div class="header">Faculty / Postdocs</div>
<div id="faculty-viewport" class="viewport"></div>

<div class="header">Staff</div>
<div id="staff-viewport" class="viewport"></div>

<div class="header">Ph.D. Students</div>
<div id="phd-viewport" class="viewport"></div>

<!-- <div class="header">Masters Students</div>
<div id="masters-viewport" class="viewport"></div> -->

<div id="person-info-modal"></div>

<!-- Javascripts -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.ianli.com/javascripts/underscore/1.1.7/underscore.min.js"></script>
<script type="text/javascript" src="jquery.tinymodal.js"></script>
<script type="text/javascript">
(function (window, $, undefined) {
	// Animator is a singleton responsible for animating animations.
	// An animation is any object that implements a tick function.
	// Animator will call the tick() function 20 times per second.
	// This object is an attempt to make the animation more efficient.
	var Animator = new (function () {
		var animations = [];
		
		this.addAnimation = function (animation) {
			animations.push(animation);
		}
		
		setInterval(function () {
			for (var i = 0, n = animations.length; i < n; i++) {
				var animation = animations[i];
				animation.tick();
			}
		}, 50);
	})();
	
	// The scrolling wall.
	var ScrollingWall = function (viewport, options) {
		if (typeof options === 'undefined') {
			options = {};
		}
		
		_.defaults(options, {
			tileWidth: 100,
			speed: 2,
			onTileCreated: function () {},
		});
		
		var $viewport = $(viewport),
			$strip = $('<div></div>').addClass('_strip').appendTo($viewport),
			$tiles = [];

		var viewportWidth = $viewport.width(),
			tileWidth = 140,
			numTilesPerViewport = Math.floor(viewportWidth / tileWidth) + 1;
		
		// The number of tiles that have been created;
		// this number will serve as ID for the newly created tiles.
		var tileId = 0;
		
		var createTile = function () {
			var $tile = $('<div></div>')
				.addClass('_tile')
				.css('left', tileId * tileWidth)
				.appendTo($strip);
				
			options.onTileCreated.apply($tile, [tileId]);

			$tiles.push($tile);
			
			tileId++;
		}
		
		for (var i = 0; i < numTilesPerViewport; i++) {
			createTile();
		}
		
		// Indicates whether the wall is scrolling.
		var running = false;
		
		// Starts scrolling the wall.
		this.run = function () {
			running = true;
		};
		
		// Stops scrolling the wall.
		this.stop = function () {
			running = false;
		}
		
		// A tick is one movement of an animation.
		// This method is called by Animator.
		this.tick = function () {
			// Return immediately if the wall is not scrolling.
			if (!running)
				return;
				
			var left = $strip.position().left;
			$strip.css('left', left - options.speed);

			// If the tile is not visible anymore, remove it.
			if (($tiles[0].position().left + tileWidth) < Math.abs(left)) {
				var $tile = $tiles.shift();
				$tile.remove();
			}

			// The tile is now visible, so create it.
			if ((tileId * tileWidth) < (Math.abs(left) + viewportWidth)) {
				createTile();
			}
		}
		
		// Add this 'animation' to Animator.
		Animator.addAnimation(this);
	};
	
	// The template for the tiles that appear in the display.
	var personInfoTemplate = _.template(
		'<div class="person-info">' +
			'<div class="_box">' +
				'<img src="<%= image %>" />' +
			'</div>' +
			'<div class="_name"><%= first_name %> <%= last_name %></div>' +
			'<div class="_title"><%= title %></div>' +
			'<div class="_room"><%= room %></div>' +
		'</div>'
	);
	
	// The template for the tiles that appear in the display.
	var tileTemplate = _.template(
		'<div class="person-tile">' +
			'<div class="_box">' +
				'<img src="<%= image %>" />' +
			'</div>' +
			'<div class="_name"><%= first_name %> <%= last_name %></div>' +
		'</div>'
	);
	
	// Fetch the JSON file of people.
	$.getJSON('http://hciibb-admin.ianli.com/people.json?callback=?', function (data, textStatus, jqXHR) {
		// Some people have missing images, so assign them with blank images.
		_.each(data, function (value, i) {
			if (!value.person.image) {
				value.person.image = 'blank.png';
			}
		});
		
		// Group the data by level.
		var dataByLevel = _.groupBy(data, function (value, i) {
			return value.person.level;
		});
		
		// Creates a tile inside `tileElement`.
		// The `level` is either 'faculty', 'staff', 'phd', or 'masters'.
		// `id` is the id of the newly created tile.
		var createTile = function (tileElement, level, id) {
			// Get the person whose tile to create.
			var data = dataByLevel[level],
				dataIndex = id % data.length,
				person = data[dataIndex].person;
		
			// Create the display for the person.
			var $el = $(tileTemplate(person))
						.appendTo(tileElement)
						.click(function () {
							// When a tile is clicked, show more information about the person.
							$('#person-info-modal')
								.html(personInfoTemplate(person))
								.tinymodal();
						});
		}
		
		new ScrollingWall(
			'#faculty-viewport',
			{
				tileWidth: 136,
				onTileCreated: function (i) {
					createTile(this, 'faculty', i);
				}
			}
		).run();
		
		new ScrollingWall(
			'#staff-viewport',
			{
				tileWidth: 136,
				onTileCreated: function (i) {
					createTile(this, 'staff', i);
				}
			}
		).run();
		
		new ScrollingWall(
			'#phd-viewport',
			{
				tileWidth: 136,
				onTileCreated: function (i) {
					createTile(this, 'phd', i);
				}
			}
		).run();

		// NOTE: This is hidden while the list of Masters students hasn't been updated.
		// new ScrollingWall(
		// 	'#masters-viewport',
		// 	{
		// 		tileWidth: 136,
		// 		onTileCreated: function (i) {
		// 			createTile(this, 'masters', i);
		// 		}
		// 	}
		// ).run();
	});
})(window, jQuery);
</script>
</body>
</html>